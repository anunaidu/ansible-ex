---
- hosts: mysql
  become: true
  vars:
          MYSQL_ROOT_PASSWD: sharath10
          MYSQL_USERNAME: jda
          update_pack_manager: yes
          #          MYSQL_PASSWD: "{E:AES}18ae14adb41924bee357e4d74e7facae"
          MYSQL_PASSWD: jda
          SQL_URL: "http://repo.mysql.com/mysql-community-release-el7-7.noarch.rpm"
  tasks:
    – name: Download MySQL Community Repo
      get_url:
        url: "{{ SQL_URL }}"
        dest: /tmp

    – name: Install MySQL Community Repo
      command: /usr/bin/rpm -ivh /tmp/mysql-community-release-el7-7.noarch.rpm

    – name: Install MySQL Server
      yum: name=mysql-server state=present update_cache={{ update_pack_manager }}

    – name: Install MySQL-python, this is required for the task remove anonymous user
      yum: name=MySQL-python state=present

    – name: Start MySQL Server and enable it
      service: name=mysqld state=started enabled=yes

    – name: Remove Test database if it exist.
      mysql_db: name=test state=absent

    – name: Remove All Anonymous User Accounts
      mysql_user: name=” host_all=yes state=absent

    – name: Output ansible_hostname
      debug: msg=”Hostname is {{ansible_hostname}}”

    – name: Change root password
      mysql_user: name=root host={{item}} password={{ MYSQL_ROOT_PASSWD }}
      with_items:
       – “{{ansible_hostname}}”
       – 127.0.0.1
       – ::1
       – localhost

    - name: Create a database
      mysql_db:
              name:
                      - JDA_ANU
                      - BHARATH_ANU
              state: present

    - name: Create a User for App
      mysql_user:
              name: "{{ MYSQL_USERNAME }}"
              password: "{{ MYSQL_PASSWD }}"
              priv: '*.*:ALL'
              state: present
